---
import { getCollection } from 'astro:content';
import '../styles/global.css'; 

const allSpots = await getCollection('spots');
// ì´ˆê¸° ì •ë ¬: ê±°ë¦¬ìˆœ
allSpots.sort((a, b) => a.data.distance - b.data.distance);
---

<html lang="ko">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>ì§€ë¦¬ì‚° ìƒíƒœíƒë°©ì› ì¸ê·¼ ê´€ê´‘ì§€</title>
	</head>
	<body class="bg-slate-50 text-slate-800 font-sans">
        
		<header class="bg-white border-b border-slate-200 sticky top-0 z-50">
            <div class="max-w-md mx-auto px-4 py-3 flex justify-between items-center">
			    <h1 class="text-lg font-bold text-slate-800">
                    â›°ï¸ ì§€ë¦¬ì‚° ì¸ê·¼ ê´€ê´‘ì§€
                </h1>
                <span class="text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded">íƒë°©ì› ê¸°ì¤€</span>
            </div>
		</header>

        <main class="max-w-md mx-auto p-4 pb-20">
            
            <!-- í†µí•© ê²€ìƒ‰ì°½ -->
            <div class="relative mb-4">
                <input type="text" id="searchInput" placeholder="ê´€ê´‘ì§€ ì´ë¦„ ê²€ìƒ‰" 
                    class="w-full p-3 pl-10 bg-white border border-slate-300 rounded-lg text-sm focus:outline-none focus:border-slate-500 transition-colors">
                <span class="absolute left-3 top-3.5 text-slate-400">ğŸ”</span>
            </div>

            <!-- ë©”ì¸ íƒ­ (ì‹¬í”Œí•˜ê²Œ ë³€ê²½) -->
            <div class="flex border-b border-slate-200 mb-4">
                <button class="main-tab active flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent transition-colors hover:text-slate-600" data-mode="category">
                    ğŸ“‚ ì¢…ë¥˜ë³„ ë³´ê¸°
                </button>
                <button class="main-tab flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent transition-colors hover:text-slate-600" data-mode="region">
                    ğŸ“ ì§€ìì²´ë³„ ë³´ê¸°
                </button>
            </div>

            <!-- í•„í„° ë²„íŠ¼ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ì¢…ë¥˜ë³„ ë²„íŠ¼ë“¤ì´ ë³´ì„) -->
            <div id="filter-container" class="flex flex-wrap gap-2 mb-6">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë²„íŠ¼ì´ ë“¤ì–´ê°ˆ ìë¦¬ -->
            </div>

            <!-- ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
            <div id="spot-list" class="space-y-3">
                {allSpots.map((spot) => (
                    <a href={`/spots/${spot.slug}`} class="block group">
                        <article class="spot-card bg-white rounded-xl border border-slate-200 p-4 hover:shadow-md transition-all active:scale-95 group-hover:border-slate-300"
                            data-title={spot.data.title}
                            data-category={spot.data.category}
                            data-region={spot.data.region}
                            data-distance={spot.data.distance}
                        >
                            <!-- 1. ë±ƒì§€ (ìƒ‰ìƒ êµ¬ë¶„ ì ìš©) -->
                            <div class="flex gap-1.5 mb-2">
                                <span class="text-[11px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded-md font-bold border border-blue-100">{spot.data.region}</span>
                                <span class={`text-[11px] px-2 py-0.5 rounded-md font-medium border ${
                                    spot.data.category === 'ìì—°' ? 'bg-green-50 text-green-700 border-green-100' :
                                    spot.data.category === 'ë¬¸í™”ìœ ì‚°' ? 'bg-orange-50 text-orange-700 border-orange-100' :
                                    'bg-slate-100 text-slate-600 border-slate-200'
                                }`}>{spot.data.category}</span>
                            </div>

                            <!-- 2. ì œëª©ê³¼ ê±°ë¦¬ -->
                            <div class="flex justify-between items-end">
                                <h2 class="text-lg font-bold text-slate-800 leading-none">{spot.data.title}</h2>
                                <div class="text-sm font-bold text-slate-600 flex items-center gap-1">
                                    <span>{spot.data.distance}km</span>
                                    <span class="text-xs text-slate-400 font-normal">({spot.data.time})</span>
                                </div>
                            </div>
                            
                            <p class="text-xs text-slate-400 mt-2 truncate">{spot.data.address}</p>
                        </article>
                    </a>
                ))}
            </div>

            <div id="no-result" class="hidden text-center py-10 text-slate-400">
                ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>

        </main>

        <style>
            .main-tab.active {
                color: #1e293b; /* slate-800 */
                border-color: #1e293b;
            }
            
            /* âœ¨ í•„í„° ì¹©(ë²„íŠ¼) ë””ìì¸ */
            .filter-chip {
                display: inline-flex;
                align-items: center;
                padding: 8px 14px;
                font-size: 0.85rem;
                font-weight: 600;
                color: #64748b; /* slate-500 */
                background-color: white;
                border: 1px solid #e2e8f0; /* slate-200 */
                border-radius: 9999px; /* ë‘¥ê¸€ê²Œ */
                cursor: pointer;
                transition: all 0.2s;
                box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            }
            
            .filter-chip:hover {
                background-color: #f8fafc; /* slate-50 */
                border-color: #cbd5e1;
                transform: translateY(-1px);
            }

            .filter-chip.active {
                background-color: #1e293b; /* slate-800 */
                color: white;
                border-color: #1e293b;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            }
        </style>

        <script>
            const searchInput = document.getElementById('searchInput');
            const container = document.getElementById('spot-list');
            const mainTabs = document.querySelectorAll('.main-tab');
            const filterContainer = document.getElementById('filter-container');
            const noResult = document.getElementById('no-result');
            
            let allCards = Array.from(document.querySelectorAll('.spot-card')).map(card => card.closest('a'));
            
            // ë°ì´í„° ì •ì˜
            const categories = ["ì „ì²´", "ìì—°", "ë¬¸í™”ìœ ì‚°", "êµ­ë¦½ê³µì›ì‹œì„¤", "ì •ì›", "ê¸°íƒ€"]; 
            const regions = ["ì „ì²´", "êµ¬ë¡€", "í•˜ë™", "ë‚¨ì›", "ìˆœì²œ", "í•¨ì–‘", "ì‚°ì²­", "ê³¡ì„±"]; 

            // ì´ˆê¸° ë¡œë”©: ì¢…ë¥˜ë³„ ë²„íŠ¼ ë³´ì—¬ì£¼ê¸°
            renderChips(categories, 'category');

            // 1. ë©”ì¸ íƒ­ í´ë¦­ (ì¢…ë¥˜ë³„ <-> ì§€ìì²´ë³„ ì „í™˜)
            mainTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    mainTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const mode = tab.getAttribute('data-mode');
                    
                    if (mode === 'category') {
                        renderChips(categories, 'category');
                    } else if (mode === 'region') {
                        renderChips(regions, 'region');
                    }
                    // íƒ­ ë°”ë€” ë•Œ í•„í„° ì´ˆê¸°í™”
                    filterList('all', 'ì „ì²´'); 
                });
            });

            // 2. ì¹©(ë²„íŠ¼) ìƒì„± í•¨ìˆ˜
            function renderChips(items, type) {
                filterContainer.innerHTML = '';
                
                items.forEach(item => {
                    const btn = document.createElement('button');
                    btn.className = 'filter-chip';
                    btn.innerText = item;
                    
                    // 'ì „ì²´' ë²„íŠ¼ì€ ì²˜ìŒì— í™œì„±í™”
                    if(item === 'ì „ì²´') btn.classList.add('active');

                    btn.onclick = () => {
                        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                        btn.classList.add('active');
                        
                        if (item === 'ì „ì²´') {
                            resetFilter();
                        } else {
                            filterList(type, item);
                        }
                    };
                    filterContainer.appendChild(btn);
                });
            }

            // 3. í•„í„°ë§ ë¡œì§
            function filterList(type, value) {
                let visibleCount = 0;
                allCards.forEach(cardLink => {
                    const card = cardLink.querySelector('.spot-card');
                    const cardValue = card.getAttribute(`data-${type}`);
                    
                    if (cardValue === value) {
                        cardLink.style.display = 'block';
                        visibleCount++;
                    } else {
                        cardLink.style.display = 'none';
                    }
                });
                checkEmpty(visibleCount);
            }

            // 4. í•„í„° ì´ˆê¸°í™” (ì „ì²´ ë³´ì´ê¸°)
            function resetFilter() {
                allCards.forEach(cardLink => cardLink.style.display = 'block');
                checkEmpty(allCards.length);
            }

            // 5. ê²€ìƒ‰ ê¸°ëŠ¥
            searchInput.addEventListener('input', (e) => {
                const keyword = e.target.value.toLowerCase();
                let visibleCount = 0;
                allCards.forEach(cardLink => {
                    const card = cardLink.querySelector('.spot-card');
                    const title = card.getAttribute('data-title').toLowerCase();
                    
                    // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•„í„° ë¬´ì‹œí•˜ê³  ê²€ìƒ‰ì–´ë¡œë§Œ ì°¾ìŒ
                    if (title.includes(keyword)) {
                        cardLink.style.display = 'block';
                        visibleCount++;
                    } else {
                        cardLink.style.display = 'none';
                    }
                });
                
                // ê²€ìƒ‰ì–´ê°€ ë¹„ë©´ ë‹¤ì‹œ í˜„ì¬ í•„í„° ì ìš© (êµ¬í˜„ ë³µì¡ë„ìƒ ì „ì²´ë³´ê¸°ë¡œ ë¦¬ì…‹)
                if (keyword === '') {
                    // í˜„ì¬ í™œì„±í™”ëœ íƒ­ ì°¾ì•„ì„œ ë¦¬ì…‹
                    const activeChip = document.querySelector('.filter-chip.active');
                    if(activeChip && activeChip.innerText !== 'ì „ì²´') {
                        // í•„í„° ìœ ì§€ ë¡œì§ì€ ë³µì¡í•´ì§€ë¯€ë¡œ ì¼ë‹¨ ê²€ìƒ‰ í›„ì—” ì „ì²´ê°€ ë³´ì´ê²Œ ì²˜ë¦¬
                        resetFilter();
                        // ì¹© ìŠ¤íƒ€ì¼ë„ ì „ì²´ë¡œ ëŒë¦¼
                        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                        filterContainer.firstChild.classList.add('active');
                    }
                }
                
                checkEmpty(visibleCount);
            });

            function checkEmpty(count) {
                noResult.style.display = count === 0 ? 'block' : 'none';
            }
        </script>
	</body>
</html>