---
// 1. í•„ìš”í•œ ê¸°ëŠ¥ ê°€ì ¸ì˜¤ê¸°
import { getCollection } from 'astro:content';

// âœ¨ 2. ìŠ¤íƒ€ì¼ íŒŒì¼ ì—°ê²° (ì´ê²Œ ê¼­ ìˆì–´ì•¼ ë””ìì¸ì´ ë‚˜ì˜µë‹ˆë‹¤!)
import '../styles/global.css'; 

// 3. ëª¨ë“  ê´€ê´‘ì§€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
const allSpots = await getCollection('spots');
---

<html lang="ko">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>ì§€ë¦¬ì‚° ìƒíƒœíƒë°©ì› ì¸ê·¼ ê´€ê´‘ì§€</title>
	</head>
	<body class="bg-gray-50 text-gray-800">
        
        <!-- ìƒë‹¨ í—¤ë” -->
		<header class="bg-green-700 text-white p-5 shadow-md sticky top-0 z-50">
            <div class="max-w-xl mx-auto">
			    <h1 class="text-xl font-bold flex items-center gap-2">
                    ğŸ”ï¸ ì§€ë¦¬ì‚° íƒë°©ì› ì¸ê·¼ ê´€ê´‘ì§€
                </h1>
                <p class="text-xs text-green-100 mt-1">ì „ë‚¨ êµ¬ë¡€êµ° ë§ˆì‚°ë©´ í™”ì—„ì‚¬ë¡œ 402-25 ê¸°ì¤€</p>
            </div>
		</header>

        <main class="max-w-xl mx-auto p-4 pb-20">
            
            <!-- í†µí•© ê²€ìƒ‰ì°½ -->
            <div class="relative mb-6">
                <input type="text" id="searchInput" placeholder="ê´€ê´‘ì§€ ì´ë¦„ ê²€ìƒ‰..." 
                    class="w-full p-3 pl-10 rounded-lg border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500">
                <span class="absolute left-3 top-3.5 text-gray-400">ğŸ”</span>
            </div>

            <!-- íƒ­ ë©”ë‰´ (í•„í„°/ì •ë ¬) -->
            <div class="flex gap-2 overflow-x-auto pb-2 mb-4 no-scrollbar">
                <button class="filter-btn active" data-type="all">ì „ì²´</button>
                <button class="filter-btn" data-type="sort-distance">ğŸ“ ê±°ë¦¬ìˆœ</button>
                <!-- ì˜ˆì‹œ: ì‹¤ì œ ë°ì´í„°ì— ìˆëŠ” ì¹´í…Œê³ ë¦¬ë¡œ í•„í„°ë§ -->
                <button class="filter-btn" data-type="category" data-value="ë¬¸í™”ìœ ì‚°">ğŸ¯ ë¬¸í™”ìœ ì‚°</button>
                <button class="filter-btn" data-type="category" data-value="ìì—°">ğŸŒ² ìì—°</button>
                <button class="filter-btn" data-type="region" data-value="êµ¬ë¡€">ğŸ“ êµ¬ë¡€</button>
            </div>

            <!-- ê´€ê´‘ì§€ ë¦¬ìŠ¤íŠ¸ -->
            <div id="spot-list" class="grid gap-4">
                {allSpots.map((spot) => (
                    <article class="spot-card bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 hover:shadow-md transition-shadow cursor-pointer"
                        data-title={spot.data.title}
                        data-category={spot.data.category}
                        data-region={spot.data.region}
                        data-distance={spot.data.distance}
                    >
                        <div class="flex h-32">
                            <!-- ì´ë¯¸ì§€ (ì—†ìœ¼ë©´ íšŒìƒ‰ ë°•ìŠ¤) -->
                            <div class="w-1/3 bg-gray-200 flex-shrink-0 relative">
                                {spot.data.image ? (
                                    <img src={spot.data.image} alt={spot.data.title} class="w-full h-full object-cover" />
                                ) : (
                                    <span class="absolute inset-0 flex items-center justify-center text-2xl">ğŸï¸</span>
                                )}
                            </div>
                            
                            <!-- ì •ë³´ -->
                            <div class="w-2/3 p-4 flex flex-col justify-between">
                                <div>
                                    <div class="flex gap-1 mb-1">
                                        <span class="text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold">{spot.data.region}</span>
                                        <span class="text-[10px] bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded">{spot.data.category}</span>
                                    </div>
                                    <h2 class="text-lg font-bold leading-tight mb-1">{spot.data.title}</h2>
                                    <p class="text-xs text-gray-500 truncate">{spot.data.address}</p>
                                </div>
                                <div class="flex items-center text-sm font-medium text-orange-600">
                                    ğŸš— {spot.data.distance}km <span class="text-gray-400 text-xs ml-1">({spot.data.time})</span>
                                </div>
                            </div>
                        </div>
                    </article>
                ))}
            </div>

        </main>

        <!-- ìŠ¤íƒ€ì¼ (Tailwind ì™¸ ì»¤ìŠ¤í…€) -->
        <style>
            .filter-btn {
                @apply px-4 py-2 bg-white border border-gray-200 rounded-full text-sm font-medium text-gray-600 whitespace-nowrap transition-colors cursor-pointer;
            }
            .filter-btn.active {
                @apply bg-green-600 text-white border-green-600;
            }
            .no-scrollbar::-webkit-scrollbar {
                display: none;
            }
            .no-scrollbar {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        </style>

        <!-- ìŠ¤í¬ë¦½íŠ¸ (ê²€ìƒ‰ ë° í•„í„° ê¸°ëŠ¥) -->
        <script>
            // íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ íƒ€ì…ì„ 'any'ë‚˜ HTMLElementë¡œ ë‹¨ì–¸í•©ë‹ˆë‹¤.
            const searchInput = document.getElementById('searchInput');
            const container = document.getElementById('spot-list');
            const filterBtns = document.querySelectorAll('.filter-btn');
            let allCards = Array.from(document.querySelectorAll('.spot-card'));

            // 1. ê²€ìƒ‰ ê¸°ëŠ¥
            searchInput?.addEventListener('input', (e) => {
                const keyword = e.target.value.toLowerCase();
                allCards.forEach(card => {
                    const title = card.getAttribute('data-title')?.toLowerCase() || '';
                    if (title.includes(keyword)) {
                        card.style.display = 'block'; // ë³´ì´ê¸°
                    } else {
                        card.style.display = 'none';  // ìˆ¨ê¸°ê¸°
                    }
                });
            });

            // 2. íƒ­ ë²„íŠ¼ í´ë¦­ (í•„í„°ë§ ë° ì •ë ¬)
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const type = btn.getAttribute('data-type');
                    const value = btn.getAttribute('data-value');

                    // ì´ˆê¸°í™”: ëª¨ë“  ì¹´ë“œ ë³´ì´ê¸°
                    allCards.forEach(card => card.style.display = 'block');

                    if (type === 'all') {
                        // ì „ì²´ë³´ê¸°: ì›ë˜ ìˆœì„œëŒ€ë¡œ (DOM ì¬ì •ë ¬ì´ í•„ìš”í•˜ë‹¤ë©´ ì¶”ê°€ ë¡œì§ í•„ìš”)
                        // ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœíˆ ìˆ¨ê¹€ í•´ì œë§Œ í•©ë‹ˆë‹¤.
                    } 
                    else if (type === 'sort-distance') {
                        // ê±°ë¦¬ìˆœ ì •ë ¬
                        const sorted = [...allCards].sort((a, b) => {
                            const distA = parseFloat(a.getAttribute('data-distance') || '0');
                            const distB = parseFloat(b.getAttribute('data-distance') || '0');
                            return distA - distB;
                        });
                        container.innerHTML = ''; // ë¹„ìš°ê³ 
                        sorted.forEach(card => container.appendChild(card)); // ë‹¤ì‹œ ì±„ìš°ê¸°
                    } 
                    else if (type === 'category' || type === 'region') {
                        // ì¢…ë¥˜ë³„ / ì§€ì—­ë³„ í•„í„°ë§
                        allCards.forEach(card => {
                            const cardValue = card.getAttribute(`data-${type}`);
                            if (cardValue === value) {
                                card.style.display = 'block';
                            } else {
                                card.style.display = 'none';
                            }
                        });
                    }
                });
            });
        </script>
	</body>
</html>