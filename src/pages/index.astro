---
import { getCollection } from 'astro:content';
import '../styles/global.css'; 

const allSpots = await getCollection('spots');
// ì´ˆê¸° ì •ë ¬: ê±°ë¦¬ìˆœ
allSpots.sort((a, b) => a.data.distance - b.data.distance);

// ì¹´ìš´íŠ¸ ê³„ì‚°
const categoryCounts = allSpots.reduce((acc, spot) => {
    acc[spot.data.category] = (acc[spot.data.category] || 0) + 1;
    return acc;
}, {});
const regionCounts = allSpots.reduce((acc, spot) => {
    acc[spot.data.region] = (acc[spot.data.region] || 0) + 1;
    return acc;
}, {});

const renderedSpots = await Promise.all(allSpots.map(async (spot) => {
  const { Content } = await spot.render();
  return { ...spot, Content };
}));
---

<html lang="ko">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>ì§€ë¦¬ì‚°ìƒíƒœíƒë°©ì› ì¸ê·¼ ê´€ê´‘ì§€ ì•ˆë‚´</title>
        <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=an3gqg9xly"></script>
	</head>
	<body class="bg-slate-50 text-slate-800 font-sans">
        
		<header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
            <div class="max-w-3xl mx-auto px-4 py-4 flex flex-col items-center justify-center">
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-2xl">ğŸ”</span>
			        <h1 class="text-xl font-bold text-slate-800 tracking-tight cursor-pointer" onclick="location.reload()">
                        ì§€ë¦¬ì‚°ìƒíƒœíƒë°©ì› ì¸ê·¼ ê´€ê´‘ì§€ ì•ˆë‚´
                    </h1>
                </div>
                <span class="text-xs text-slate-500 bg-slate-100 px-3 py-1 rounded-full font-medium">ì „ë‚¨ êµ¬ë¡€êµ° ë§ˆì‚°ë©´ í™”ì—„ì‚¬ë¡œ 402-25 ê¸°ì¤€</span>
            </div>
		</header>

        <main class="max-w-3xl mx-auto p-4 pb-20">
            
            <!-- í†µí•© ê²€ìƒ‰ì°½ -->
            <div class="relative mb-8 mt-2">
                <input type="text" id="searchInput" placeholder="ê´€ê´‘ì§€ ì´ë¦„ ê²€ìƒ‰ (ì˜ˆ: í™”ì—„ì‚¬, ë…¸ê³ ë‹¨)" 
                    class="w-full p-3.5 pl-11 bg-white border border-slate-300 rounded-xl text-base focus:outline-none focus:border-slate-600 focus:ring-1 focus:ring-slate-600 transition-all shadow-sm">
                <span class="absolute left-4 top-4 text-slate-400 text-lg">ğŸ”</span>
            </div>
            
            <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
            <p class="text-xs text-slate-500 text-center mb-6">
                ğŸ’¡ ê´€ê´‘ì§€ ì´ë¦„ì„ í´ë¦­í•˜ì‹œë©´ ìì„¸í•œ ë‚´ìš©ì„ ë³´ì‹¤ ìˆ˜ ìˆì–´ìš”
            </p>

            <!-- íƒ­ ë©”ë‰´ -->
            <div class="flex border-b border-slate-200 mb-6">
                <button class="main-tab active flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent hover:text-slate-600 transition-colors" data-mode="category">
                    ğŸ“ ê±°ë¦¬ìˆœ ({allSpots.length})
                </button>
                <button class="main-tab flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent hover:text-slate-600 transition-colors" data-mode="region">
                    ğŸ“ ì§€ìì²´ë³„
                </button>
                <a href="https://heritagekorea.vercel.app/" target="_blank" class="flex-1 py-3 text-sm font-bold text-green-600 border-b-2 border-transparent hover:text-green-800 hover:bg-slate-50 transition-colors text-center flex items-center justify-center gap-1">
                    ğŸ›ï¸ êµ­ê°€ìœ ì‚° ê²€ìƒ‰ <span class="text-xs">â†—</span>
                </a>
            </div>

            <!-- í•˜ìœ„ í•„í„° (ì•Œì•½ ë””ìì¸) -->
            <div id="sub-filter-container" class="mb-8 flex flex-wrap gap-2 justify-center"></div>

            <!-- ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
            <div id="spot-list" class="space-y-3">
                {renderedSpots.map((spot) => (
                    <div class="spot-item group"
                        data-title={spot.data.title}
                        data-category={spot.data.category}
                        data-region={spot.data.region}
                        data-distance={spot.data.distance}
                    >
                        <!-- ì¹´ë“œ í—¤ë” -->
                        <div class="spot-header bg-white rounded-xl border border-slate-200 p-5 cursor-pointer hover:shadow-md hover:border-slate-300 transition-all flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <div class="flex flex-col gap-1 items-start">
                                    <span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded border border-blue-100 font-bold">{spot.data.region}</span>
                                    <span class={`text-[10px] px-2 py-0.5 rounded border font-bold ${
                                        spot.data.category === 'ìì—°' ? 'bg-green-50 text-green-700 border-green-100' :
                                        spot.data.category === 'ë¬¸í™”ìœ ì‚°' ? 'bg-orange-50 text-orange-700 border-orange-100' :
                                        'bg-slate-100 text-slate-600 border-slate-200'
                                    }`}>{spot.data.category}</span>
                                </div>
                                <h2 class="text-lg font-bold text-slate-800 group-hover:text-slate-600 transition-colors">{spot.data.title}</h2>
                            </div>
                            
                            <div class="text-right min-w-[80px]">
                                <div class="text-base font-bold text-green-700">{spot.data.distance}km</div>
                                <div class="text-xs text-slate-400 font-medium">({spot.data.time})</div>
                            </div>
                        </div>

                        <!-- ìƒì„¸ ë‚´ìš© (ì•„ì½”ë””ì–¸) -->
                        <div class="detail-area hidden bg-slate-50 border-x border-b border-slate-200 rounded-b-xl p-5 animate-fade-in">
                             
                            <p class="text-sm text-slate-500 mb-5 flex items-start gap-1 pb-4 border-b border-slate-200">
                                <span class="shrink-0">ğŸ“</span> <span class="font-medium">{spot.data.address}</span>
                            </p>

                            <div class="prose prose-sm max-w-none mb-6 text-slate-700 leading-relaxed bg-white p-4 rounded-lg border border-slate-100">
                                <spot.Content />
                            </div>

                            <div cla