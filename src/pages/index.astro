---
import { getCollection } from 'astro:content';
import '../styles/global.css'; 

const allSpots = await getCollection('spots');
// ì´ˆê¸° ì •ë ¬: ê±°ë¦¬ìˆœ
allSpots.sort((a, b) => a.data.distance - b.data.distance);

// ì¹´ìš´íŠ¸ ê³„ì‚°
const categoryCounts = allSpots.reduce((acc, spot) => {
    acc[spot.data.category] = (acc[spot.data.category] || 0) + 1;
    return acc;
}, {});
const regionCounts = allSpots.reduce((acc, spot) => {
    acc[spot.data.region] = (acc[spot.data.region] || 0) + 1;
    return acc;
}, {});

const renderedSpots = await Promise.all(allSpots.map(async (spot) => {
  const { Content } = await spot.render();
  return { ...spot, Content };
}));
---

<html lang="ko">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>ì§€ë¦¬ì‚°ìƒíƒœíƒë°©ì› ì¸ê·¼ ê´€ê´‘ì§€ ì•ˆë‚´</title>
        <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=an3gqg9xly"></script>
	</head>
	<body class="bg-slate-50 text-slate-800 font-sans">
        
		<header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
            <div class="max-w-3xl mx-auto px-4 py-4 flex flex-col items-center justify-center">
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-2xl">ğŸ”</span>
			        <h1 class="text-xl font-bold text-slate-800 tracking-tight cursor-pointer" onclick="location.reload()">
                        ì§€ë¦¬ì‚°ìƒíƒœíƒë°©ì› ì¸ê·¼ ê´€ê´‘ì§€ ì•ˆë‚´
                    </h1>
                </div>
                <span class="text-xs text-slate-500 bg-slate-100 px-3 py-1 rounded-full font-medium">ì „ë‚¨ êµ¬ë¡€êµ° ë§ˆì‚°ë©´ í™”ì—„ì‚¬ë¡œ 402-25 ê¸°ì¤€</span>
            </div>
		</header>

        <main class="max-w-3xl mx-auto p-4 pb-20">
            
            <!-- 3ë‹¨ íƒ­ ë©”ë‰´ -->
            <div class="mode-tabs flex border-b border-slate-200 mb-6">
                <button class="mode-tab active flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent hover:text-slate-600 transition-colors" onclick="switchMode('name')">
                    ì´ë¦„ìœ¼ë¡œ ì°¾ê¸°
                </button>
                <button class="mode-tab flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent hover:text-slate-600 transition-colors" onclick="switchMode('region')">
                    ì§€ì—­ìœ¼ë¡œ ì°¾ê¸°
                </button>
                <button class="mode-tab flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent hover:text-slate-600 transition-colors" onclick="switchMode('nearby')">
                    ğŸ“ ë‚´ ê·¼ì²˜ ì°¾ê¸°
                </button>
            </div>

            <!-- 1. ì´ë¦„ ê²€ìƒ‰ì°½ -->
            <div id="search-name" class="search-container active mb-6">
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="ê´€ê´‘ì§€ ì´ë¦„ ê²€ìƒ‰ (ì˜ˆ: í™”ì—„ì‚¬, ë…¸ê³ ë‹¨)" 
                        class="w-full p-3.5 pl-11 bg-white border border-slate-300 rounded-xl text-base focus:outline-none focus:border-slate-600 focus:ring-1 focus:ring-slate-600 transition-all shadow-sm">
                    <span class="absolute left-4 top-4 text-slate-400 text-lg">ğŸ”</span>
                </div>
                <p class="text-xs text-slate-500 text-center mt-2">
                    ğŸ’¡ ê´€ê´‘ì§€ ì´ë¦„ì„ í´ë¦­í•˜ì‹œë©´ ìì„¸í•œ ë‚´ìš©ì„ ë³´ì‹¤ ìˆ˜ ìˆì–´ìš”
                </p>
            </div>

            <!-- 2. ì§€ì—­ ê²€ìƒ‰ -->
            <div id="search-region" class="search-container hidden mb-6">
                <div id="region-main-scroll" class="flex flex-wrap gap-2 justify-center mb-4"></div>
                <div id="sub-region-area" class="hidden bg-slate-100 p-4 rounded-xl text-center">
                    <span class="block text-sm font-bold text-slate-600 mb-2">â–¼ ìƒì„¸ ì§€ì—­ ì„ íƒ</span>
                    <div id="region-sub-scroll" class="flex flex-wrap gap-2 justify-center"></div>
                </div>
            </div>

            <!-- 3. ë‚´ ê·¼ì²˜ ì°¾ê¸° -->
            <div id="search-nearby" class="search-container hidden mb-6 text-center">
                <p class="text-sm text-slate-500 mb-4">í˜„ì¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì—¬ ê°€ê¹Œìš´ ìˆœì„œëŒ€ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.</p>
                <button onclick="sortByLocation()" id="gpsBtn" class="px-6 py-3 bg-green-600 text-white rounded-full font-bold shadow-md hover:bg-green-700 transition">
                    ğŸ“¡ ë‚´ ìœ„ì¹˜ í™•ì¸í•˜ê³  ê²€ìƒ‰í•˜ê¸°
                </button>
            </div>

            <!-- í•„í„° íƒ­ -->
            <div class="flex border-b border-slate-200 mb-6">
                <button class="filter-tab active flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent hover:text-slate-600 transition-colors" data-mode="category">
                    ğŸ“ ê±°ë¦¬ìˆœ ({allSpots.length})
                </button>
                <button class="filter-tab flex-1 py-3 text-sm font-bold text-slate-400 border-b-2 border-transparent hover:text-slate-600 transition-colors" data-mode="region">
                    ğŸ“ ì§€ìì²´ë³„
                </button>
            </div>

            <!-- í•˜ìœ„ í•„í„° -->
            <div id="sub-filter-container" class="mb-8 flex flex-wrap gap-2 justify-center"></div>

            <!-- ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
            <div id="spot-list" class="space-y-3">
                {renderedSpots.map((spot) => (
                    <div class="spot-item group"
                        data-title={spot.data.title}
                        data-category={spot.data.category}
                        data-region={spot.data.region}
                        data-distance={spot.data.distance}
                        data-lat={spot.data.lat} 
                        data-lng={spot.data.lng}
                    >
                        <!-- ì¹´ë“œ í—¤ë” -->
                        <div class="spot-header bg-white rounded-xl border border-slate-200 p-5 cursor-pointer hover:shadow-md hover:border-slate-300 transition-all flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <div class="flex flex-col gap-1 items-start">
                                    <span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded border border-blue-100 font-bold">{spot.data.region}</span>
                                    <span class={`text-[10px] px-2 py-0.5 rounded border font-bold ${
                                        spot.data.category === 'ìì—°' ? 'bg-green-50 text-green-700 border-green-100' :
                                        spot.data.category === 'ë¬¸í™”ìœ ì‚°' ? 'bg-orange-50 text-orange-700 border-orange-100' :
                                        'bg-slate-100 text-slate-600 border-slate-200'
                                    }`}>{spot.data.category}</span>
                                </div>
                                <h2 class="text-lg font-bold text-slate-800 group-hover:text-slate-600 transition-colors">{spot.data.title}</h2>
                            </div>
                            
                            <div class="text-right min-w-[80px]">
                                <div class="text-base font-bold text-green-700 distance-text">{spot.data.distance}km</div>
                                <div class="text-xs text-slate-400 font-medium">({spot.data.time})</div>
                            </div>
                        </div>

                        <!-- ìƒì„¸ ë‚´ìš© -->
                        <div class="detail-area hidden bg-slate-50 border-x border-b border-slate-200 rounded-b-xl p-5 animate-fade-in">
                             
                            <p class="text-sm text-slate-500 mb-5 flex items-start gap-1 pb-4 border-b border-slate-200">
                                <span class="shrink-0">ğŸ“</span> <span class="font-medium">{spot.data.address}</span>
                            </p>

                            <div class="prose prose-sm max-w-none mb-6 text-slate-700 leading-relaxed bg-white p-4 rounded-lg border border-slate-100">
                                <spot.Content />
                            </div>

                            <div class="mb-5">
                                <button class="w-full py-3 bg-white border border-slate-300 rounded-lg text-slate-700 font-bold flex items-center justify-center gap-2 hover:bg-slate-100 transition shadow-sm map-toggle-btn"
                                    data-lat={spot.data.lat} 
                                    data-lng={spot.data.lng}
                                    id={`btn-map-${spot.slug}`}
                                >
                                    ğŸ—ºï¸ ì§€ë„ ë³´ê¸°
                                </button>
                                <div id={`map-${spot.slug}`} class="w-full h-72 bg-slate-200 rounded-lg mt-2 hidden relative overflow-hidden border border-slate-300"></div>
                            </div>

                            <div class="flex gap-2">
                                <a href={`https://www.google.com/search?q=${spot.data.region} ${spot.data.title}`} target="_blank" class="flex-1 py-3 bg-white border border-slate-300 rounded-lg text-center text-sm font-bold text-slate-600 hover:bg-slate-50 hover:text-slate-800 hover:border-slate-400 transition shadow-sm">
                                    G êµ¬ê¸€
                                </a>
                                <a href={`https://www.youtube.com/results?search_query=${spot.data.region} ${spot.data.title}`} target="_blank" class="flex-1 py-3 bg-white border border-slate-300 rounded-lg text-center text-sm font-bold text-slate-600 hover:bg-slate-50 hover:text-slate-800 hover:border-slate-400 transition shadow-sm">
                                    ğŸ“º ìœ íŠœë¸Œ
                                </a>
                                <a href={`https://heritagekorea.vercel.app/?q=${spot.data.title}`} target="_blank" class="flex-1 py-3 bg-slate-700 text-white rounded-lg text-center text-sm font-bold shadow-sm hover:bg-slate-800 transition border border-slate-700">
                                    ğŸ›ï¸ êµ­ê°€ìœ ì‚°
                                </a>
                            </div>
                        </div>
                    </div>
                ))}
            </div>

            <div id="no-result" class="hidden text-center py-20">
                <span class="text-4xl mb-2 block">ğŸ¤”</span>
                <span class="text-slate-400 font-medium">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
            </div>
            
            <div class="text-center mt-8">
                <button id="loadMoreBtn" class="hidden px-8 py-3 bg-white border border-slate-300 rounded-full text-slate-600 font-bold shadow-sm hover:bg-slate-50 transition text-sm">
                    ê²°ê³¼ ë”ë³´ê¸° +
                </button>
            </div>
        </main>

        <!-- ê´€ë ¨ ì‚¬ì´íŠ¸ ë§í¬ -->
        <div class="related-section max-w-3xl mx-auto px-4 mb-10">
            <h3 class="text-sm text-slate-400 text-center mb-4 font-medium">ê´€ë ¨ ì‚¬ì´íŠ¸ ë°”ë¡œê°€ê¸°</h3>
            <div class="grid grid-cols-3 sm:grid-cols-5 gap-2">
                <a href="https://www.youtube.com/channel/UCWJHLijeKNpQpFq_bn63TKw" target="_blank" class="link-card">
                    <span class="text-xl mb-1">ğŸ“º</span><span>ìƒíƒœíƒë°©ì›<br>ìœ íŠœë¸Œ</span>
                </a>
                <a href="https://www.facebook.com/jirisan.NC/" target="_blank" class="link-card">
                    <span class="text-xl mb-1">ğŸ“˜</span><span>í˜ì´ìŠ¤ë¶</span>
                </a>
                <a href="https://www.instagram.com/jirisan_naturecenter/" target="_blank" class="link-card">
                    <span class="text-xl mb-1">ğŸ“·</span><span>ì¸ìŠ¤íƒ€ê·¸ë¨</span>
                </a>
                <a href="https://reservation.knps.or.kr/" target="_blank" class="link-card">
                    <span class="text-xl mb-1">ğŸ“…</span><span>êµ­ë¦½ê³µì›<br>ì˜ˆì•½</span>
                </a>
                <a href="https://www.knps.or.kr/front/portal/safe/acsCtrList.do?menuNo=8000340" target="_blank" class="link-card">
                    <span class="text-xl mb-1">ğŸš§</span><span>íƒë°©ë¡œ<br>í†µì œì •ë³´</span>
                </a>
            </div>
        </div>

        <div class="footer">
            - Made by ì´íƒœê±´ -<br>
            <span class="contact-link" onclick="copyEmail()">ğŸ“© ë¬¸ì˜í•˜ê¸° (Contact)</span><br>
            <div class="hits-badge">
                <img src="https://api.visitorbadge.io/api/visitors?path=https%3A%2F%2Fexam1-beige.vercel.app&countColor=%232C3E50&style=flat" />
            </div>
        </div>

        <style is:global>
            .mode-tab.active { color: #1e293b; border-color: #1e293b; }
            .filter-tab.active { color: #1e293b; border-color: #1e293b; }
            
            /* ì•Œì•½ ë””ìì¸ */
            .filter-chip { 
                display: inline-flex; align-items: center; justify-content: center;
                padding: 8px 18px; font-size: 0.95rem; font-weight: 500; 
                color: #4b5563; background-color: white; border: 1px solid #d1d5db; 
                border-radius: 9999px; cursor: pointer; transition: all 0.2s; 
                box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            }
            .filter-chip:hover { background-color: #f3f4f6; border-color: #9ca3af; color: #1f2937; }
            .filter-chip.active { background-color: #2c3e50; color: white; border-color: #2c3e50; font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

            /* ì¹´ë“œí˜• ë§í¬ */
            .link-card {
                display: flex; flex-direction: column; align-items: center; justify-content: center;
                background: white; border: 1px solid #e2e8f0; border-radius: 12px;
                padding: 12px 5px; text-align: center; text-decoration: none;
                color: #64748b; font-size: 0.8em; font-weight: 600;
                transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
                height: 80px;
            }
            .link-card:hover { transform: translateY(-3px); border-color: #2c3e50; color: #2c3e50; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }

            .footer { text-align: center; margin-top: 20px; padding-top: 30px; border-top: 1px solid #e2e8f0; color: #64748b; font-size: 0.85em; line-height: 1.8; }
            .contact-link { display: inline-block; margin-top: 5px; cursor: pointer; color: #475569; font-weight: 600; transition: 0.2s; }
            .contact-link:hover { color: #2c3e50; text-decoration: underline; }
            .hits-badge { margin-top: 15px; display: inline-block; opacity: 0.8; transition: opacity 0.2s; }
            .hits-badge:hover { opacity: 1; }
            .hits-badge img { height: 20px; vertical-align: middle; }

            @keyframes fade-in { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
            .animate-fade-in { animation: fade-in 0.2s ease-out forwards; }
        </style>

        <script define:vars={{ categoryCounts, regionCounts, allSpotsLength: allSpots.length, myEmail: "naturekr@gmail.com" }}>
            window.categoryCounts = categoryCounts;
            window.regionCounts = regionCounts;
            window.allSpotsLength = allSpotsLength;
            window.myEmail = myEmail;
        </script>

        <script>
            // DOM ìš”ì†Œ
            const searchInput = document.getElementById('searchInput');
            const subFilterContainer = document.getElementById('sub-filter-container');
            const noResult = document.getElementById('no-result');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const spotItems = Array.from(document.querySelectorAll('.spot-item'));
            const modeTabs = document.querySelectorAll('.mode-tab');
            const filterTabs = document.querySelectorAll('.filter-tab');

            // ë°ì´í„° ìƒìˆ˜
            const categories = ["ì „ì²´", "ìì—°", "ë¬¸í™”ìœ ì‚°", "êµ­ë¦½ê³µì›ì‹œì„¤", "ì •ì›", "ê¸°íƒ€"]; 
            const regions = ["ì „ì²´", "êµ¬ë¡€", "í•˜ë™", "ë‚¨ì›", "ìˆœì²œ", "í•¨ì–‘", "ì‚°ì²­", "ê³¡ì„±"]; 
            const SUB_REGIONS = {
                "êµ¬ë¡€": ["êµ¬ë¡€ì", "ë§ˆì‚°ë©´", "ê´‘ì˜ë©´", "ìš©ë°©ë©´", "ì‚°ë™ë©´", "í† ì§€ë©´", "ê°„ì „ë©´", "ë¬¸ì²™ë©´"],
                "í•˜ë™": ["í•˜ë™ì", "í™”ê°œë©´", "ì•…ì–‘ë©´", "ì ëŸ‰ë©´", "íš¡ì²œë©´", "ê³ ì „ë©´", "ê¸ˆë‚¨ë©´", "ê¸ˆì„±ë©´", "ì§„êµë©´", "ì–‘ë³´ë©´", "ë¶ì²œë©´", "ì²­ì•”ë©´", "ì˜¥ì¢…ë©´"],
                "ë‚¨ì›": ["ë‚¨ì›ì‹œ", "ìš´ë´‰ì", "ì£¼ì²œë©´", "ìˆ˜ì§€ë©´", "ì†¡ë™ë©´", "ì£¼ìƒë©´", "ê¸ˆì§€ë©´", "ëŒ€ê°•ë©´", "ëŒ€ì‚°ë©´", "ì‚¬ë§¤ë©´", "ë•ê³¼ë©´", "ë³´ì ˆë©´", "ì‚°ë™ë©´", "ì´ë°±ë©´", "ì•„ì˜ë©´", "ì‚°ë‚´ë©´", "ì¸ì›”ë©´"],
                "ìˆœì²œ": ["ìˆœì²œì‹œ", "ìŠ¹ì£¼ì", "í•´ë£¡ë©´", "ì„œë©´", "í™©ì „ë©´", "ì›”ë“±ë©´", "ì£¼ì•”ë©´", "ì†¡ê´‘ë©´", "ì™¸ì„œë©´", "ë‚™ì•ˆë©´", "ë³„ëŸ‰ë©´", "ìƒì‚¬ë©´"],
                "í•¨ì–‘": ["í•¨ì–‘ì", "ë§ˆì²œë©´", "íœ´ì²œë©´", "ìœ ë¦¼ë©´", "ìˆ˜ë™ë©´", "ì§€ê³¡ë©´", "ì•ˆì˜ë©´", "ì„œí•˜ë©´", "ì„œìƒë©´", "ë°±ì „ë©´", "ë³‘ê³¡ë©´"],
                "ì‚°ì²­": ["ì‚°ì²­ì", "ì°¨í™©ë©´", "ì˜¤ë¶€ë©´", "ìƒì´ˆë©´", "ê¸ˆì„œë©´", "ì‚¼ì¥ë©´", "ì‹œì²œë©´", "ë‹¨ì„±ë©´", "ì‹ ì•ˆë©´", "ìƒë¹„ëŸ‰ë©´", "ì‹ ë“±ë©´"],
                "ê³¡ì„±": ["ê³¡ì„±ì", "ì˜¤ê³¡ë©´", "ì‚¼ê¸°ë©´", "ì„ê³¡ë©´", "ëª©ì‚¬ë™ë©´", "ì£½ê³¡ë©´", "ê³ ë‹¬ë©´", "ì˜¥ê³¼ë©´", "ì…ë©´", "ê²¸ë©´", "ì˜¤ì‚°ë©´"]
            };

            // ìƒíƒœ ë³€ìˆ˜
            let limit = 10;
            let currentFilteredItems = []; 
            let currentFilterType = 'category'; // 'category' or 'region'
            let currentFilterValue = 'ì „ì²´';

            // ì´ˆê¸° ì‹¤í–‰
            renderSubChips(categories, 'category');
            filterAndPagination('all', 'ì „ì²´'); 

            // ì´ë©”ì¼ ë³µì‚¬
            window.copyEmail = function() {
                navigator.clipboard.writeText(window.myEmail).then(() => {
                    alert(`ğŸ“§ ì´ë©”ì¼ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n(${window.myEmail})`);
                });
            };

            // 1. ê²€ìƒ‰ ëª¨ë“œ ì „í™˜ (ì´ë¦„/ì§€ì—­/ë‚´ì£¼ë³€)
            window.switchMode = (mode) => {
                document.querySelectorAll('.mode-tab').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.search-container').forEach(c => c.classList.remove('active'));
                
                if(mode === 'name') {
                    document.querySelectorAll('.mode-tab')[0].classList.add('active');
                    document.getElementById('search-name').classList.add('active');
                    // ì´ë¦„ ê²€ìƒ‰ ëª¨ë“œì—ì„œëŠ” í•„í„° íƒ­ ë³´ì´ê¸°
                    document.querySelector('.filter-tab[data-mode="category"]').click();
                } else if(mode === 'region') {
                    document.querySelectorAll('.mode-tab')[1].classList.add('active');
                    document.getElementById('search-region').classList.add('active');
                    // ì§€ì—­ ê²€ìƒ‰ ëª¨ë“œì—ì„œëŠ” 'ì§€ìì²´ë³„' í•„í„° ìë™ ì„ íƒ
                    document.querySelector('.filter-tab[data-mode="region"]').click();
                } else if(mode === 'nearby') {
                    document.querySelectorAll('.mode-tab')[2].classList.add('active');
                    document.getElementById('search-nearby').classList.add('active');
                }
            };

            // 2. í•„í„° íƒ­ ì „í™˜ (ê±°ë¦¬ìˆœ/ì§€ìì²´ë³„)
            filterTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    filterTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const mode = tab.getAttribute('data-mode');
                    
                    if (mode === 'category') renderSubChips(categories, 'category');
                    else if (mode === 'region') renderSubChips(regions, 'region');
                    
                    // íƒ­ ë³€ê²½ ì‹œ ì „ì²´ ë³´ê¸°ë¡œ ë¦¬ì…‹
                    limit = 10;
                    filterAndPagination('all', 'ì „ì²´');
                });
            });

            // 3. ì¹© ìƒì„± (ì•Œì•½ ë””ìì¸)
            function renderSubChips(items, type) {
                subFilterContainer.innerHTML = '';
                items.forEach(item => {
                    let count = 0;
                    if (item === 'ì „ì²´') count = window.allSpotsLength;
                    else count = (type === 'category' ? window.categoryCounts[item] : window.regionCounts[item]) || 0;

                    if(count > 0 || item === 'ì „ì²´') {
                        const btn = document.createElement('button');
                        btn.className = 'filter-chip'; 
                        if(item === 'ì „ì²´') btn.classList.add('active');
                        btn.innerText = `${item} (${count})`;
                        
                        btn.onclick = () => {
                            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                            btn.classList.add('active');
                            
                            limit = 10; 
                            currentFilterType = type;
                            currentFilterValue = item;
                            
                            if(item === 'ì „ì²´') filterAndPagination('all', 'ì „ì²´');
                            else filterAndPagination(type, item);
                        };
                        subFilterContainer.appendChild(btn);
                    }
                });
            }

            // 4. ì§€ì—­ìœ¼ë¡œ ì°¾ê¸° (ìƒì„¸ ì§€ì—­ ì¹© ìƒì„±)
            const regionMainScroll = document.getElementById('region-main-scroll');
            if(regionMainScroll) {
                let html = "";
                regions.forEach(r => {
                    if(r !== 'ì „ì²´') html += `<button class="chip-btn" onclick="selectMainRegion('${r}', this)">${r}</button>`;
                });
                regionMainScroll.innerHTML = html;
            }

            window.selectMainRegion = (regionName, btn) => {
                document.querySelectorAll('#region-main-scroll .chip-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const subArea = document.getElementById('sub-region-area');
                const subScroll = document.getElementById('region-sub-scroll');
                const subList = SUB_REGIONS[regionName];

                if (!subList || subList.length === 0) {
                    subArea.style.display = 'none';
                } else {
                    subArea.style.display = 'block';
                    let html = `<button class="chip-btn active" onclick="filterAndPagination('region', '${regionName}')">ì „ì²´</button>`;
                    subList.forEach(sub => {
                        // ìƒì„¸ ì§€ì—­ í•„í„°ë§ì€ ì£¼ì†Œ(address)ì— í•´ë‹¹ í…ìŠ¤íŠ¸ê°€ í¬í•¨ë˜ëŠ”ì§€ë¡œ íŒë‹¨
                        html += `<button class="chip-btn" onclick="filterByAddress('${sub}', this)">${sub}</button>`;
                    });
                    subScroll.innerHTML = html;
                }
                
                // ìƒìœ„ ì§€ì—­ ì„ íƒ ì‹œ í•´ë‹¹ ì§€ì—­ í•„í„°ë§ ì‹¤í–‰
                limit = 10;
                filterAndPagination('region', regionName);
            };

            window.filterByAddress = (subRegion, btn) => {
                document.querySelectorAll('#region-sub-scroll .chip-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const keyword = subRegion;
                currentFilteredItems = spotItems.filter(item => {
                    const address = item.querySelector('.text-sm.text-slate-500').innerText; // ì£¼ì†Œ í…ìŠ¤íŠ¸ ì¶”ì¶œ
                    return address.includes(keyword);
                });
                updateDisplay();
            };

            // 5. í•„í„°ë§ + í˜ì´ì§€ë„¤ì´ì…˜ í•µì‹¬ ë¡œì§
            function filterAndPagination(type, value) {
                const keyword = searchInput.value.toLowerCase();
                
                currentFilteredItems = spotItems.filter(item => {
                    const header = item.querySelector('.spot-header');
                    const title = header.getAttribute('data-title').toLowerCase();
                    const cardValue = header.getAttribute(`data-${type}`);
                    
                    const matchesSearch = title.includes(keyword);
                    const matchesFilter = (value === 'ì „ì²´') || (cardValue === value);
                    
                    return matchesSearch && matchesFilter;
                });

                updateDisplay();
            }

            function updateDisplay() {
                spotItems.forEach(item => item.style.display = 'none');
                currentFilteredItems.slice(0, limit).forEach(item => {
                    item.style.display = 'block';
                });
                noResult.style.display = currentFilteredItems.length === 0 ? 'block' : 'none';

                if (currentFilteredItems.length > limit) {
                    loadMoreBtn.style.display = 'inline-block';
                    const remain = currentFilteredItems.length - limit;
                    loadMoreBtn.innerText = `ê²°ê³¼ ë”ë³´ê¸° + (${remain}ê°œ ë‚¨ìŒ)`;
                } else {
                    loadMoreBtn.style.display = 'none';
                }
            }

            // ë”ë³´ê¸° ë²„íŠ¼
            loadMoreBtn.addEventListener('click', () => {
                limit += 10;
                updateDisplay();
            });

            // ê²€ìƒ‰ ê¸°ëŠ¥
            window.searchByName = () => {
                const keyword = searchInput.value.toLowerCase();
                limit = 10;
                // ê²€ìƒ‰ ì‹œì—ëŠ” ì „ì²´ í•„í„°ì—ì„œ ê²€ìƒ‰
                currentFilteredItems = spotItems.filter(item => {
                    const title = item.querySelector('.spot-header').getAttribute('data-title').toLowerCase();
                    return title.includes(keyword);
                });
                updateDisplay();
            };

            searchInput.addEventListener('input', searchByName);

            // ë‚´ ì£¼ë³€ ì°¾ê¸°
            window.sortByLocation = () => {
                const btn = document.getElementById('gpsBtn');
                btn.innerText = "ğŸ“¡ ìœ„ì¹˜ í™•ì¸ ì¤‘...";

                if (!navigator.geolocation) { alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); return; }

                navigator.geolocation.getCurrentPosition((position) => {
                    const myLat = position.coords.latitude;
                    const myLng = position.coords.longitude;

                    // í˜„ì¬ í•„í„°ë§ëœ ì•„ì´í…œ(ë˜ëŠ” ì „ì²´)ì„ ê±°ë¦¬ìˆœ ì •ë ¬
                    if(currentFilteredItems.length === 0) currentFilteredItems = [...spotItems];

                    currentFilteredItems.forEach(item => {
                        const lat = parseFloat(item.getAttribute('data-lat'));
                        const lng = parseFloat(item.getAttribute('data-lng'));
                        if (lat && lng) {
                            const dist = getDistance(myLat, myLng, lat, lng);
                            // ê±°ë¦¬ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ì„ íƒ ì‚¬í•­)
                            // item.querySelector('.distance-text').innerText = dist.toFixed(1) + 'km';
                            item.setAttribute('data-real-distance', dist); // ì •ë ¬ìš© ì†ì„± ì¶”ê°€
                        } else {
                            item.setAttribute('data-real-distance', 99999);
                        }
                    });

                    currentFilteredItems.sort((a, b) => {
                        return parseFloat(a.getAttribute('data-real-distance')) - parseFloat(b.getAttribute('data-real-distance'));
                    });

                    // DOM ì¬ë°°ì¹˜
                    const container = document.getElementById('spot-list');
                    container.innerHTML = '';
                    currentFilteredItems.forEach(item => container.appendChild(item));
                    
                    limit = 10;
                    updateDisplay();
                    btn.innerText = "âœ… ê±°ë¦¬ìˆœ ì •ë ¬ ì™„ë£Œ";
                }, () => {
                    alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    btn.innerText = "ğŸ“ ë‚´ ì£¼ë³€ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ê¸°";
                });
            };

            function getDistance(lat1, lon1, lat2, lon2) {
                const R = 6371; 
                const dLat = deg2rad(lat2 - lat1);
                const dLon = deg2rad(lon2 - lon1);
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
                return R * c;
            }
            function deg2rad(deg) { return deg * (Math.PI/180); }

            // ì•„ì½”ë””ì–¸ & ì§€ë„ í† ê¸€
            document.querySelectorAll('.spot-header').forEach(header => {
                header.addEventListener('click', () => {
                    const detail = header.nextElementSibling;
                    detail.classList.toggle('hidden');
                });
            });

            document.querySelectorAll('.map-toggle-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    const lat = parseFloat(btn.getAttribute('data-lat'));
                    const lng = parseFloat(btn.getAttribute('data-lng'));
                    const mapDiv = btn.nextElementSibling;
                    
                    if(mapDiv.classList.contains('hidden')) {
                        mapDiv.classList.remove('hidden');
                        btn.innerText = "ğŸ—ºï¸ ì§€ë„ ë‹«ê¸°";
                        
                        if(!mapDiv.hasChildNodes()) {
                            if(typeof naver === "undefined") {
                                mapDiv.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">ì§€ë„ API ë¡œë”© ì‹¤íŒ¨ (localhost ë“±ë¡ í™•ì¸ í•„ìš”)</div>';
                                return;
                            }
                            const map = new naver.maps.Map(mapDiv, {
                                center: new naver.maps.LatLng(lat, lng),
                                zoom: 14
                            });
                            new naver.maps.Marker({ position: new naver.maps.LatLng(lat, lng), map: map });
                        }
                    } else {
                        mapDiv.classList.add('hidden');
                        btn.innerText = "ğŸ—ºï¸ ì§€ë„ ë³´ê¸°";
                    }
                });
            });
        </script>
	</body>
</html>